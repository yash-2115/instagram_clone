{% extends 'base.html' %}

{% block title %}{{ post.user.username }} Post Details{% endblock title %}

{% load static %}
{% load humanize %}

{% block content %}
<div class="album py-5 bg-light mb-0">
  <div class="container">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 g-2">
      {% for cont in post.content.all %}
      <div class="col">
        <div class="card shadow-sm">
          {% if cont.file.name|slice:"-3:" == 'jpg' or cont.file.name|slice:"-3:" == 'png' %}
          <a href="{{ cont.get_absolute_url }}">
            <img class="bd-placeholder-img card-img-top" width="100%" height="225" src="{{ cont.file.url }}">
          </a>
          {% else %}
          <a href="{{ cont.get_absolute_url }}">
            <video width="640" controls="controls" preload="metadata">
              <source src="{{ cont.file.url }}#t=0.5" type="video/mp4">
            </video>
          </a>
          {% endif %}
          <div class="card-body">
            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional
              content. This content is a little bit longer.</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="btn-group">
                <a type="button" class="btn btn-sm btn-outline-danger disabled">Delete (coming soon)</a>
              </div>
              <small class="text-muted">{{ post.posted|naturaltime }}</small>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="card mb-3 mt-3 w-100">
      <div class="row g-0">
        <div class="col-md-2">
          {% if post.user.profile.picture %}
          <img src="{{ post.user.profile.picture.url }}" alt="Placeholder image">
          {% else %}
          <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
          {% endif %}
        </div>
        <div class="col-md-7">
          <div class="card-body">
            {% if post.user.profile.first_name %}
            <h5 class="card-title">{{ post.user.profile.first_name }} {{ post.user.profile.last_name }}</h5>
            {% else %}
            <p class="title is-4">Unknown</p>
            {% endif %}
            <p class="subtitle is-6">@{{ post.user.username }}</p>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card-body">
            {% if favorited is True %}
            <a class="card-text btn btn-danger" href="{% url 'postfavorite' post.id %}">Remove Post</a>
            {% else %}

            <a class="card-text btn btn-success" href="{% url 'postfavorite' post.id %}">Save Post</a>

            {% endif %}
            <a class="card-text btn btn-danger" href="{% url 'postlike' post.id %}">{{ post.likes }} Likes</a>
          </div>
        </div>
        <div class="m-3">
          <h5>Caption</h5>
          <p class="card-text">{{ post.caption }}</p>

          <h5>#tags</h5>
          <p class="card-text">
            {% for tag in post.tags.all %}
            <a href="{{ tag.get_absolute_url }}">#{{ tag }}</a>
            {% endfor %}
          </p>
          <p class="card-text"><small class="text-muted">{{ post.posted }}</small></p>
        </div>
      </div>
    </div>
  </div>
</div>

<!--  -->
<div class="columns is-mobile is-centered">
  <div class="column">
    <div class="card-content">
      {% for comment in comments %}
      <article class="media">
        <figure class="media-left">
          <p class="image is-64x64">
            {% if comment.user.profile.picture %}
            <img src="{{ comment.user.profile.picture.url }}" alt="Placeholder image">
            {% else %}
            <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
            {% endif %}
          </p>
        </figure>

        <div class="media-content">
          <div class="content">
            <p>
              {% if comment.user.profile.first_name %}
              <strong>{{ comment.user.profile.first_name }} {{ comment.user.profile.last_name }}</strong><small>
                @{{ comment.user.username }}</small>
              {% else %}
              <strong>Unknown</strong>
              {% endif %}
              <br>
              {{ comment.body }}
              <br>
              <strong><small>{{ comment.date|naturaltime }}</small></strong>
            </p>
          </div>

      </article>
      {% endfor %}

      <h4>Comment</h4>
      <article class="media">
        <figure class="media-left">
          <p class="image is-64x64">
            {% if request.user.profile.picture %}
            <img src="{{ request.user.profile.picture.url }}" alt="Placeholder image">
            {% else %}
            <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
            {% endif %}
          </p>
        </figure>
        <div class="media-content">
          <form method="post" action="" role="form">
            {% csrf_token %}
            <div class="field">
              <p class="control">
                {{ form.body }}
              </p>
            </div>
            <div class="field">
              <p class="control">
                <button type="submit" name="action" class="button">Post comment</button>
              </p>
            </div>
          </form>
        </div>
      </article>
    </div>
  </div>
</div>

{% endblock %}